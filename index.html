<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SLIDE CATCHER</title>
    <style>
        /* --- VARIABLES --- */
        :root {
            --bg-color: #f4f4f9;
            --container-bg: #ffffff;
            --text-color: #333;
            --primary-color: #007bff;
            --accent-color: #ff4757; 
            --game-bg: #1a1a1a;
            --wa-color: #25D366;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            overscroll-behavior: none; 
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        .container {
            background: var(--container-bg);
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 420px;
            text-align: center;
            box-sizing: border-box;
        }

        h1 {
            margin: 0 0 5px 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sub-text {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 15px;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            background: #eee;
            padding: 10px;
            border-radius: 10px;
            color: #333;
        }

        /* GAME CANVAS */
        canvas {
            background-color: var(--game-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: block;
            margin: 0 auto;
            cursor: pointer; 
            touch-action: none; 
            max-width: 100%; 
        }

        /* BUTTONS */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
            margin-top: 20px;
            width: 80%;
            box-shadow: 0 4px 10px rgba(0,123,255,0.3);
        }

        .btn:active { transform: scale(0.95); }
        .btn-restart { display: none; background-color: var(--text-color); }

        /* CONTROLS ROW */
        .controls-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        /* TOGGLE BUTTONS (Sound & Pause) */
        .control-toggle {
            background: #f0f0f0;
            border: none;
            padding: 8px 16px; 
            border-radius: 30px; 
            cursor: pointer;
            color: #555;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px; 
            transition: background 0.2s;
            font-weight: 600;
            font-size: 0.85rem;
        }
        .control-toggle:hover { background: #e0e0e0; }
        .control-icon { width: 16px; height: 16px; fill: currentColor; }

        /* LEGEND */
        .legend {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            font-size: 0.7rem;
            color: #555;
            flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; border: 1px solid #ccc; }

        /* FOOTER */
        .divider { height: 1px; background-color: #ddd; margin: 2rem 0; }
        
        .projects-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .portfolio-link {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            background-color: #f8f9fa; color: #333; text-decoration: none;
            padding: 12px; border-radius: 10px; border: 1px solid #ddd;
            font-weight: 600; font-size: 0.9rem; transition: 0.2s;
        }
        .portfolio-link:hover { background: #eee; transform: translateY(-2px); }
        
        .footer p { font-size: 0.85rem; color: #666; margin-bottom: 1rem; }
        .whatsapp-btn {
            display: inline-flex; align-items: center; gap: 8px;
            background-color: var(--wa-color); color: white; text-decoration: none;
            padding: 10px 20px; border-radius: 50px; font-weight: bold; font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>SLIDE CATCHER</h1>
    <p class="sub-text">Drag screen to move • Colors are optional!</p>
    
    <div class="score-board">
        <span id="scoreEl">Score: 0</span>
        <span id="livesEl">Lives: 3</span>
    </div>

    <canvas id="gameCanvas" width="320" height="450"></canvas>

    <div class="legend">
        <div class="legend-item"><div class="dot" style="background:#ffffff"></div>Std</div>
        <div class="legend-item"><div class="dot" style="background:#2ecc71"></div>Wide</div>
        <div class="legend-item"><div class="dot" style="background:#ff4757"></div>Trap</div>
        <div class="legend-item"><div class="dot" style="background:#00d2d3"></div>Slow</div>
        <div class="legend-item"><div class="dot" style="background:#ced6e0"></div>Ghost</div>
        <div class="legend-item"><div class="dot" style="background:#e056fd"></div>+1 Life</div>
    </div>

    <div class="controls-row">
        <button id="soundBtn" class="control-toggle" title="Toggle Sound">
            <svg id="icon-sound-on" class="control-icon" viewBox="0 0 24 24">
                <path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zm-4 0h-2.5l-5 5H2v6h2.5l5 5h2.5V3.23z"/>
            </svg>
            <svg id="icon-sound-off" class="control-icon" style="display:none;" viewBox="0 0 24 24">
                 <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
            </svg>
            <span>Sound</span>
        </button>

        <button id="pauseBtn" class="control-toggle" title="Pause Game" disabled>
            <svg id="icon-pause" class="control-icon" viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
            <svg id="icon-play" class="control-icon" style="display:none;" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
            </svg>
            <span id="pauseText">Pause</span>
        </button>
    </div>

    <button id="startBtn" class="btn">Start Game</button>
    <button id="restartBtn" class="btn btn-restart">Try Again</button>

    <div class="divider"></div>

    <div class="projects-list">
        <a href="https://edupdf-one.vercel.app/" target="_blank" class="portfolio-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#007bff" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"/>
            </svg>
            Visit EduPDF
        </a>

        <a href="https://yorubago.vercel.app/" target="_blank" class="portfolio-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#007bff" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/>
            </svg>
            YorubaGo Translator
        </a>
    </div>

    <div class="footer">
        <p>Want a game or website like this?</p>
        <a href="https://wa.me/2349042427548" target="_blank" class="whatsapp-btn">
            <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
            Chat on WhatsApp
        </a>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('scoreEl');
    const livesEl = document.getElementById('livesEl');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    
    // Toggle Buttons
    const soundBtn = document.getElementById('soundBtn');
    const iconSoundOn = document.getElementById('icon-sound-on');
    const iconSoundOff = document.getElementById('icon-sound-off');

    const pauseBtn = document.getElementById('pauseBtn');
    const iconPause = document.getElementById('icon-pause');
    const iconPlay = document.getElementById('icon-play');
    const pauseText = document.getElementById('pauseText');

    // Game Variables
    let isPlaying = false;
    let isPaused = false;
    let score = 0;
    let lives = 3;
    let animationId;
    let frameCount = 0;
    let baseSpeed = 2; 
    let spawnRate = 60;
    let speedReduction = 0;
    let soundEnabled = true;
    
    // Ghost Mode Variables
    let ghostMode = false;
    let ghostTimer = null;
    
    // LIMITS SETTINGS
    const MAX_WIDTH = 150; 
    const MIN_WIDTH = 30;  

    // Audio Context
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playSound(type) {
        if (!soundEnabled) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();

        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'normal') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        } 
        else if (type === 'wide') {
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.2);
        } 
        else if (type === 'narrow') {
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.2);
        }
        else if (type === 'life') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
            oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); 
            oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); 
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.4);
        }
        else if (type === 'slow') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime); 
            oscillator.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.3); 
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }
        else if (type === 'ghost') {
            // Eerie wobble sound
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime); 
            oscillator.frequency.linearRampToValueAtTime(250, audioCtx.currentTime + 0.1); 
            oscillator.frequency.linearRampToValueAtTime(200, audioCtx.currentTime + 0.2); 
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- BUTTON LISTENERS ---
    
    soundBtn.addEventListener('click', () => {
        soundEnabled = !soundEnabled;
        if (soundEnabled) {
            iconSoundOn.style.display = 'block';
            iconSoundOff.style.display = 'none';
        } else {
            iconSoundOn.style.display = 'none';
            iconSoundOff.style.display = 'block';
        }
        // Remove focus to prevent sticky hover states on mobile
        soundBtn.blur();
    });

    pauseBtn.addEventListener('click', () => {
        if (!isPlaying) return; // Can't pause if not playing

        isPaused = !isPaused;
        
        if (isPaused) {
            // Game Paused
            iconPause.style.display = 'none';
            iconPlay.style.display = 'block';
            pauseText.textContent = "Play";
            cancelAnimationFrame(animationId); // Stop loop
            
            // Draw Pause Text
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText("PAUSED", canvas.width/2, canvas.height/2);
            
        } else {
            // Game Resumed
            iconPause.style.display = 'block';
            iconPlay.style.display = 'none';
            pauseText.textContent = "Pause";
            animate(); // Restart loop
        }
        pauseBtn.blur();
    });

    // --- GAME LOGIC ---

    const player = {
        x: 125,
        y: 410,
        width: 70,
        height: 15,
        color: '#007bff'
    };

    let balls = [];

    // Movement Logic
    function movePlayer(clientX) {
        if (isPaused) return; // Don't move if paused
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        let mouseX = (clientX - rect.left) * scaleX;
        player.x = mouseX - (player.width / 2);

        if (player.x < 0) player.x = 0;
        if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
    }

    canvas.addEventListener('mousemove', (e) => { if(isPlaying) movePlayer(e.clientX); });
    
    canvas.addEventListener('touchstart', (e) => {
        if(e.target === canvas) e.preventDefault(); 
    }, { passive: false });

    canvas.addEventListener('touchmove', (e) => { 
        if(isPlaying) {
            if(e.target === canvas) e.preventDefault(); 
            movePlayer(e.touches[0].clientX); 
        }
    }, { passive: false });


    class Ball {
        constructor() {
            this.radius = 8;
            this.x = Math.random() * (canvas.width - this.radius * 2) + this.radius;
            this.y = -this.radius;
            
            const rand = Math.random();
            // PROBABILITY DISTRIBUTION
            if (rand > 0.98) { // 2% Chance - Life
                this.type = 'life';
                this.color = '#e056fd'; 
            } else if (rand > 0.94) { // 4% Chance - Ghost
                this.type = 'ghost';
                this.color = '#ced6e0'; // Silver/Gray
            } else if (rand > 0.90) { // 4% Chance - Slow Down
                this.type = 'slow';
                this.color = '#00d2d3'; 
            } else if (rand > 0.80) { // 10% Chance - Wide
                this.type = 'wide';  
                this.color = '#2ecc71'; 
            } else if (rand > 0.70) { // 10% Chance - Narrow
                this.type = 'narrow'; 
                this.color = '#ff4757'; 
            } else {
                this.type = 'normal';
                this.color = '#ffffff'; 
            }

            let calculatedSpeed = baseSpeed + (Math.floor(score / 5) * 0.3) - speedReduction;
            this.speed = Math.max(1.5, calculatedSpeed);
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
            // Stroke for ghost ball to make it visible against grey background if needed
            if (this.type === 'ghost') {
                ctx.strokeStyle = '#555';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
            ctx.closePath();

            // Text labels
            if (this.type === 'life') {
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('+1', this.x, this.y + 1);
            }
            if (this.type === 'slow') {
                ctx.fillStyle = '#000000';
                ctx.font = '9px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('Slow', this.x, this.y + 1);
            }
            if (this.type === 'ghost') {
                ctx.fillStyle = '#000000';
                ctx.font = '9px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('??', this.x, this.y + 1);
            }
        }

        update() {
            this.y += this.speed;
        }
    }

    function activateGhostMode() {
        ghostMode = true;
        // Visual indicator: Semi-transparent paddle
        player.color = 'rgba(255, 255, 255, 0.4)'; 
        
        // Clear existing timer if user catches another ghost ball while active
        if (ghostTimer) clearTimeout(ghostTimer);

        ghostTimer = setTimeout(() => {
            ghostMode = false;
            player.color = '#007bff'; // Revert color
        }, 3000); // 3 Seconds
    }

    function animate() {
        if (!isPlaying || isPaused) return;

        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Player
        // If ghost mode, use the special color set in activateGhostMode
        // If not, ensure it is blue (or red/green from other effects)
        if (!ghostMode && player.color === 'rgba(255, 255, 255, 0.4)') {
             player.color = '#007bff';
        }

        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);
        
        // Draw Grip
        if (!ghostMode) {
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.fillRect(player.x + player.width/2 - 2, player.y + 2, 4, 11);
        }

        frameCount++;
        let currentSpawnRate = Math.max(20, spawnRate - (score * 0.5));
        
        if (frameCount % Math.floor(currentSpawnRate) === 0) {
            balls.push(new Ball());
        }

        balls.forEach((ball, index) => {
            ball.update();
            ball.draw();

            if (
                ball.y + ball.radius >= player.y &&
                ball.y - ball.radius <= player.y + player.height &&
                ball.x >= player.x &&
                ball.x <= player.x + player.width
            ) {
                // Caught!
                
                if (ball.type !== 'life' && ball.type !== 'slow' && ball.type !== 'ghost') {
                    score++;
                    scoreEl.textContent = `Score: ${score}`;
                }

                if (ball.type === 'normal') {
                    playSound('normal');
                }
                else if (ball.type === 'wide') {
                    playSound('wide');
                    if(player.width < MAX_WIDTH) {
                        player.width += 15;
                        if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
                    }
                    if (!ghostMode) {
                        player.color = '#2ecc71'; 
                        setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200);
                    }
                } 
                else if (ball.type === 'narrow') {
                    playSound('narrow');
                    if(player.width > MIN_WIDTH) player.width -= 15;
                    if (!ghostMode) {
                        player.color = '#ff4757'; 
                        setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200);
                    }
                }
                else if (ball.type === 'life') {
                    playSound('life');
                    lives++;
                    livesEl.textContent = `Lives: ${lives}`;
                    if (!ghostMode) {
                        player.color = '#e056fd'; 
                        setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200);
                    }
                }
                else if (ball.type === 'slow') {
                    playSound('slow');
                    speedReduction += 0.8;
                    if (!ghostMode) {
                        player.color = '#00d2d3'; 
                        setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200);
                    }
                }
                else if (ball.type === 'ghost') {
                    playSound('ghost');
                    activateGhostMode();
                }

                balls.splice(index, 1);
            }
            else if (ball.y - ball.radius > canvas.height) {
                // Ball hit bottom (Missed)
                balls.splice(index, 1);
                
                if (ball.type === 'normal') {
                    // GHOST MODE CHECK:
                    // If Ghost Mode is active, missing a normal ball does NOT reduce lives.
                    if (!ghostMode) {
                        lives--;
                        livesEl.textContent = `Lives: ${lives}`;
                        if (lives <= 0) endGame();
                    }
                }
            }
        });

        animationId = requestAnimationFrame(animate);
    }

    function startGame() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        isPlaying = true;
        isPaused = false;
        pauseBtn.disabled = false;
        
        score = 0;
        lives = 3;
        balls = [];
        player.width = 70;
        player.color = '#007bff';
        speedReduction = 0;
        ghostMode = false;
        if (ghostTimer) clearTimeout(ghostTimer);
        
        scoreEl.textContent = 'Score: 0';
        livesEl.textContent = 'Lives: 3';
        
        // Reset UI
        startBtn.style.display = 'none';
        restartBtn.style.display = 'none';
        iconPause.style.display = 'block';
        iconPlay.style.display = 'none';
        pauseText.textContent = "Pause";
        
        animate();
    }

    function endGame() {
        isPlaying = false;
        isPaused = false;
        pauseBtn.disabled = true;
        cancelAnimationFrame(animationId);
        
        ctx.fillStyle = 'rgba(0,0,0,0.85)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#ff4757';
        ctx.font = 'bold 36px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20);
        
        ctx.fillStyle = '#fff';
        ctx.font = '20px Arial';
        ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2 + 20);

        restartBtn.style.display = 'inline-block';
    }

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);

    // Initial Draw
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);

</script>

</body>
</html>