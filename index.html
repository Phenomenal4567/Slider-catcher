<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SLIDE CATCHER</title>
    <style>
        /* --- VARIABLES --- */
        :root {
            --bg-color: #f4f4f9;
            --container-bg: #ffffff;
            --text-color: #333;
            --primary-color: #007bff;
            --accent-color: #ff4757; 
            --gold-color: #f1c40f;
            --game-bg: #1a1a1a;
            --wa-color: #25D366;
            --wa-hover: #128C7E;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
            overscroll-behavior: none; 
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        .container {
            background: var(--container-bg);
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 420px;
            text-align: center;
            box-sizing: border-box;
            position: relative;
            margin-bottom: 20px;
        }

        h1 {
            margin: 0 0 5px 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 900;
        }

        /* --- PRIZE ALERT BANNER --- */
        .prize-alert {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #000;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.4);
            animation: pulse 2s infinite;
            border: 2px solid #fff;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .prize-title { font-weight: 900; font-size: 1.1rem; display: block; margin-bottom: 4px; }
        .prize-sub { font-size: 0.9rem; opacity: 0.9; font-weight: 700; }

        .score-board {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 1rem;
            background: #eee;
            padding: 10px 15px;
            border-radius: 12px;
            color: #333;
        }

        .score-left { text-align: left; }
        .score-right { text-align: right; }
        
        .main-stat { font-weight: 800; font-size: 1.2rem; display: block; }
        .sub-stat { font-size: 0.85rem; color: #666; font-weight: 600; display: block; margin-top: 2px; }

        /* GAME CANVAS */
        canvas {
            background-color: var(--game-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: block;
            margin: 0 auto;
            cursor: pointer; 
            touch-action: none; 
            max-width: 100%; 
        }

        /* BUTTONS */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
            margin-top: 20px;
            width: 80%;
            box-shadow: 0 4px 10px rgba(0,123,255,0.3);
        }

        .btn:active { transform: scale(0.95); }
        .btn-restart { display: none; background-color: var(--text-color); }

        /* MODALS */
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            border-radius: 20px;
            display: none; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .modal-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 95%;
            animation: popIn 0.3s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title { font-size: 1.5rem; color: #2ecc71; margin-bottom: 10px; }
        .modal-text { font-size: 1rem; color: #555; margin-bottom: 20px; line-height: 1.5; }
        .win-amount { font-size: 2rem; color: var(--gold-color); display: block; margin: 10px 0; font-weight: 800; }
        .win-code-box { background: #eee; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-family: monospace; font-size: 1.1rem; color: #333; letter-spacing: 1px; }
        
        .modal-btn-group { display: flex; flex-direction: column; gap: 10px; }
        .btn-cashout { background-color: #2ecc71; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-risk { background-color: #ff4757; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        .btn-claim {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            background-color: var(--wa-color); color: white; text-decoration: none;
            padding: 15px; border-radius: 8px; font-weight: bold; font-size: 1rem;
            width: 100%; box-sizing: border-box; margin-bottom: 10px;
        }
        .btn-claim:hover { background-color: var(--wa-hover); }

        /* CONTROLS */
        .controls-row { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }

        .control-toggle {
            background: #f0f0f0; border: none; padding: 8px 16px; border-radius: 30px; 
            cursor: pointer; color: #555; display: inline-flex; align-items: center; 
            justify-content: center; gap: 6px; transition: background 0.2s; font-weight: 600; font-size: 0.85rem;
        }
        .control-toggle:hover { background: #e0e0e0; }
        .control-icon { width: 16px; height: 16px; fill: currentColor; }

        .legend { display: flex; justify-content: center; gap: 8px; margin-top: 15px; font-size: 0.7rem; color: #555; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; border: 1px solid #ccc; }

        /* FOOTER */
        .divider { height: 1px; background-color: #ddd; margin: 2rem 0; }
        .projects-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .portfolio-link {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            background-color: #f8f9fa; color: #333; text-decoration: none;
            padding: 12px; border-radius: 10px; border: 1px solid #ddd;
            font-weight: 600; font-size: 0.9rem; transition: 0.2s;
        }
        .portfolio-link:hover { background: #eee; transform: translateY(-2px); }
        .footer p { font-size: 0.85rem; color: #666; margin-bottom: 1rem; }
        .whatsapp-btn {
            display: inline-flex; align-items: center; gap: 8px;
            background-color: var(--wa-color); color: white; text-decoration: none;
            padding: 10px 20px; border-radius: 50px; font-weight: bold; font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>SLIDE CATCHER</h1>
    
    <div class="prize-alert">
        <span class="prize-title">?? Win &#8358;500 at 1200 Points! ??</span>
        <span class="prize-sub">?? Only <span id="codesLeftDisplay">215</span> Codes Remaining!</span>
    </div>

    <div class="score-board">
        <div class="score-left">
            <span class="main-stat">Score: <span id="scoreVal">0</span></span>
            <span class="sub-stat">Lives: <span id="livesVal">3</span></span>
        </div>
        <div class="score-right">
            <span class="main-stat" style="font-size: 1rem; color: #555;">Best</span>
            <span class="sub-stat" id="highScoreVal" style="font-size: 1.1rem; color: #007bff;">0</span>
        </div>
    </div>

    <canvas id="gameCanvas" width="320" height="450"></canvas>

    <div id="decisionModal" class="modal-overlay">
        <div class="modal-box">
            <h2 class="modal-title">?? Milestone! ??</h2>
            <p class="modal-text">You reached 1200 Points!<br>You can claim <strong>&#8358;500</strong> now.</p>
            <div class="modal-btn-group">
                <button id="cashOutBtn" class="btn-cashout">?? Cash Out &#8358;500</button>
                <button id="riskBtn" class="btn-risk">?? Risk it for &#8358;1,000</button>
            </div>
            <p style="font-size:0.8rem; color:#999; margin-top:15px;">Target for &#8358;1,000 is 3000 points.</p>
        </div>
    </div>

    <div id="claimModal" class="modal-overlay">
        <div class="modal-box">
            <h2 class="modal-title">?? WINNER! ??</h2>
            <p class="modal-text">Congratulations! You won:</p>
            <span id="finalWinAmount" class="win-amount">&#8358;500</span>
            <p class="modal-text">Your Claim Code:</p>
            <div id="finalWinCode" class="win-code-box">Loading...</div>
            
            <a id="whatsappClaimLink" href="#" target="_blank" class="btn-claim">
                <svg width="24" height="24" fill="white" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                Claim on WhatsApp
            </a>
            <button id="closeClaimBtn" style="background:none; border:1px solid #ccc; padding:10px; border-radius:8px; cursor:pointer; width:100%;">Close Game</button>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item"><div class="dot" style="background:#ffffff"></div>Std</div>
        <div class="legend-item"><div class="dot" style="background:#2ecc71"></div>Wide</div>
        <div class="legend-item"><div class="dot" style="background:#ff4757"></div>Trap</div>
        <div class="legend-item"><div class="dot" style="background:#00d2d3"></div>Slow</div>
        <div class="legend-item"><div class="dot" style="background:#ced6e0"></div>Ghost</div>
        <div class="legend-item"><div class="dot" style="background:#e056fd"></div>+1 Life</div>
    </div>

    <div class="controls-row">
        <button id="soundBtn" class="control-toggle" title="Toggle Sound">
            <svg id="icon-sound-on" class="control-icon" viewBox="0 0 24 24"><path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zm-4 0h-2.5l-5 5H2v6h2.5l5 5h2.5V3.23z"/></svg>
            <svg id="icon-sound-off" class="control-icon" style="display:none;" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
            <span>Sound</span>
        </button>

        <button id="pauseBtn" class="control-toggle" title="Pause Game" disabled>
            <svg id="icon-pause" class="control-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            <svg id="icon-play" class="control-icon" style="display:none;" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <span id="pauseText">Pause</span>
        </button>
    </div>

    <button id="startBtn" class="btn">Start Game</button>
    <button id="restartBtn" class="btn btn-restart">Try Again</button>

    <div class="divider"></div>

    <div class="projects-list">
        <a href="https://edupdf-one.vercel.app/" target="_blank" class="portfolio-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#007bff" xmlns="http://www.w3.org/2000/svg"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"/></svg>
            Visit EduPDF
        </a>
        <a href="https://yorubago.vercel.app/" target="_blank" class="portfolio-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#007bff" xmlns="http://www.w3.org/2000/svg"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/></svg>
            YorubaGo Translator
        </a>
    </div>

    <div class="footer">
        <p>Want a game or website like this?</p>
        <a href="https://wa.me/2349042427548" target="_blank" class="whatsapp-btn">
            <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            Chat on WhatsApp
        </a>
    </div>
</div>

<script>
    // --- SETUP VARIABLES ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('scoreVal');
    const livesVal = document.getElementById('livesVal');
    const highScoreVal = document.getElementById('highScoreVal');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    
    // UI Elements
    const soundBtn = document.getElementById('soundBtn');
    const iconSoundOn = document.getElementById('icon-sound-on');
    const iconSoundOff = document.getElementById('icon-sound-off');
    const pauseBtn = document.getElementById('pauseBtn');
    const iconPause = document.getElementById('icon-pause');
    const iconPlay = document.getElementById('icon-play');
    const pauseText = document.getElementById('pauseText');
    const codesLeftDisplay = document.getElementById('codesLeftDisplay');

    // Modals & Logic
    const decisionModal = document.getElementById('decisionModal');
    const claimModal = document.getElementById('claimModal');
    const cashOutBtn = document.getElementById('cashOutBtn');
    const riskBtn = document.getElementById('riskBtn');
    const finalWinAmount = document.getElementById('finalWinAmount');
    const finalWinCode = document.getElementById('finalWinCode');
    const whatsappClaimLink = document.getElementById('whatsappClaimLink');
    const closeClaimBtn = document.getElementById('closeClaimBtn');

    // Game Logic
    let isPlaying = false;
    let isPaused = false;
    let score = 0;
    let highScore = localStorage.getItem('slideCatcherHighScore') || 0;
    let lives = 3;
    let animationId;
    let frameCount = 0;
    let baseSpeed = 2; 
    let spawnRate = 60;
    let speedReduction = 0;
    let soundEnabled = true;
    let milestone1200Triggered = false;
    let isRiskingIt = false; 
    let securedAmount = 0; 
    let finalWonAmount = 0;
    let ghostMode = false;
    let ghostTimer = null;
    const MAX_WIDTH = 150; 
    const MIN_WIDTH = 30;  
    
    // Audio
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    // Init UI
    highScoreVal.textContent = highScore;
    
    function updateCodesDisplay() {
        let currentCount = localStorage.getItem('phenomenalCount');
        if (!currentCount) currentCount = 215;
        codesLeftDisplay.textContent = currentCount;
    }
    updateCodesDisplay();

    // --- SOUND ENGINE ---
    function playSound(type) {
        if (!soundEnabled) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'normal') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.1);
        } else if (type === 'wide') {
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.2);
        } else if (type === 'narrow') {
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.2);
        } else if (type === 'life') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
            oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); 
            oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); 
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.4);
        } else if (type === 'slow') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime); 
            oscillator.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.3); 
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.3);
        } else if (type === 'ghost') {
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime); 
            oscillator.frequency.linearRampToValueAtTime(250, audioCtx.currentTime + 0.1); 
            oscillator.frequency.linearRampToValueAtTime(200, audioCtx.currentTime + 0.2); 
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- UI LISTENERS ---
    soundBtn.addEventListener('click', () => {
        soundEnabled = !soundEnabled;
        if (soundEnabled) { iconSoundOn.style.display='block'; iconSoundOff.style.display='none'; } 
        else { iconSoundOn.style.display='none'; iconSoundOff.style.display='block'; }
        soundBtn.blur();
    });

    pauseBtn.addEventListener('click', () => {
        if (!isPlaying || decisionModal.style.display === 'flex') return;
        isPaused = !isPaused;
        if (isPaused) {
            iconPause.style.display='none'; iconPlay.style.display='block'; pauseText.textContent="Play";
            cancelAnimationFrame(animationId);
            ctx.fillStyle = 'rgba(0,0,0,0.5)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff'; ctx.font = 'bold 30px Arial'; ctx.textAlign = 'center'; ctx.fillText("PAUSED", canvas.width/2, canvas.height/2);
        } else {
            iconPause.style.display='block'; iconPlay.style.display='none'; pauseText.textContent="Pause";
            animate();
        }
        pauseBtn.blur();
    });

    cashOutBtn.addEventListener('click', () => {
        finalWonAmount = 500;
        decisionModal.style.display = 'none';
        showWinnerScreen();
    });

    riskBtn.addEventListener('click', () => {
        isRiskingIt = true;
        decisionModal.style.display = 'none';
        isPaused = false;
        pauseBtn.disabled = false;
        animate();
    });

    closeClaimBtn.addEventListener('click', () => {
        claimModal.style.display = 'none';
        restartBtn.style.display = 'inline-block';
        ctx.fillStyle = 'rgba(0,0,0,0.9)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#2ecc71'; ctx.font = 'bold 32px Arial'; ctx.textAlign = 'center'; ctx.fillText("?? CASHED OUT! ??", canvas.width/2, canvas.height/2);
    });

    function generateWinningCode() {
        let currentCount = localStorage.getItem('phenomenalCount');
        if (!currentCount) currentCount = 215; else currentCount = parseInt(currentCount);
        if (currentCount > 0) localStorage.setItem('phenomenalCount', currentCount - 1);
        updateCodesDisplay(); 
        return `PhenomenalXZY${currentCount}`;
    }

    function showWinnerScreen() {
        isPlaying = false;
        cancelAnimationFrame(animationId);
        const code = generateWinningCode();
        finalWinAmount.innerHTML = `&#8358;${finalWonAmount.toLocaleString()}`;
        finalWinCode.textContent = code;
        const message = `Hello! I played SLIDE CATCHER. I scored ${score} points and WON &#8358;${finalWonAmount.toLocaleString()}! My Claim Code is: ${code}`;
        whatsappClaimLink.href = `https://wa.me/2349042427548?text=${encodeURIComponent(message)}`;
        claimModal.style.display = 'flex';
    }

    // --- GAMEPLAY ---
    const player = { x: 125, y: 410, width: 70, height: 15, color: '#007bff' };
    let balls = [];

    function movePlayer(clientX) {
        if (isPaused) return; 
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        let mouseX = (clientX - rect.left) * scaleX;
        player.x = mouseX - (player.width / 2);
        if (player.x < 0) player.x = 0;
        if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
    }

    canvas.addEventListener('mousemove', (e) => { if(isPlaying) movePlayer(e.clientX); });
    canvas.addEventListener('touchstart', (e) => { if(e.target === canvas) e.preventDefault(); }, { passive: false });
    canvas.addEventListener('touchmove', (e) => { if(isPlaying) { if(e.target === canvas) e.preventDefault(); movePlayer(e.touches[0].clientX); }}, { passive: false });

    class Ball {
        constructor() {
            this.radius = 8;
            this.x = Math.random() * (canvas.width - this.radius * 2) + this.radius;
            this.y = -this.radius;
            const rand = Math.random();
            if (rand > 0.98) { this.type = 'life'; this.color = '#e056fd'; } 
            else if (rand > 0.94) { this.type = 'ghost'; this.color = '#ced6e0'; } 
            else if (rand > 0.90) { this.type = 'slow'; this.color = '#00d2d3'; } 
            else if (rand > 0.80) { this.type = 'wide';  this.color = '#2ecc71'; } 
            else if (rand > 0.70) { this.type = 'narrow'; this.color = '#ff4757'; } 
            else { this.type = 'normal'; this.color = '#ffffff'; }
            let calculatedSpeed = baseSpeed + (Math.floor(score / 5) * 0.3) - speedReduction;
            this.speed = Math.max(1.5, calculatedSpeed);
        }
        draw() {
            ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill();
            if (this.type === 'ghost') { ctx.strokeStyle = '#555'; ctx.lineWidth = 1; ctx.stroke(); }
            ctx.closePath();
            ctx.fillStyle = this.type === 'normal' ? 'transparent' : (this.type === 'ghost' ? '#000' : '#fff');
            if (this.type === 'life') this.drawText('+1'); if (this.type === 'slow') { ctx.fillStyle='#000'; this.drawText('Slow'); } if (this.type === 'ghost') this.drawText('??');
        }
        drawText(txt) { ctx.font = '10px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(txt, this.x, this.y + 1); }
        update() { this.y += this.speed; }
    }

    function activateGhostMode() {
        ghostMode = true; player.color = 'rgba(255, 255, 255, 0.4)'; 
        if (ghostTimer) clearTimeout(ghostTimer);
        ghostTimer = setTimeout(() => { ghostMode = false; player.color = '#007bff'; }, 3000);
    }

    function updateHighScore() {
        if (score > highScore) {
            highScore = score;
            highScoreVal.textContent = highScore;
            localStorage.setItem('slideCatcherHighScore', highScore);
        }
    }

    function animate() {
        if (!isPlaying || isPaused) return;

        // --- WINNING THRESHOLD: 1200 POINTS ---
        if (score >= 1200 && !milestone1200Triggered) {
            milestone1200Triggered = true; isPaused = true; pauseBtn.disabled = true;
            cancelAnimationFrame(animationId); decisionModal.style.display = 'flex'; return; 
        }
        if (score >= 3000 && isRiskingIt && securedAmount !== 1000) { securedAmount = 1000; playSound('life'); }

        ctx.fillStyle = '#1a1a1a'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        if (!ghostMode && player.color === 'rgba(255, 255, 255, 0.4)') player.color = '#007bff';
        ctx.fillStyle = player.color; ctx.fillRect(player.x, player.y, player.width, player.height);
        if (!ghostMode) { ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.fillRect(player.x + player.width/2 - 2, player.y + 2, 4, 11); }

        frameCount++;
        let currentSpawnRate = Math.max(20, spawnRate - (score * 0.5));
        if (frameCount % Math.floor(currentSpawnRate) === 0) balls.push(new Ball());

        balls.forEach((ball, index) => {
            ball.update(); ball.draw();
            if (ball.y + ball.radius >= player.y && ball.y - ball.radius <= player.y + player.height && ball.x >= player.x && ball.x <= player.x + player.width) {
                if (ball.type !== 'life' && ball.type !== 'slow' && ball.type !== 'ghost') { 
                    score++; scoreVal.textContent = score; 
                    updateHighScore(); 
                }
                
                if (ball.type === 'normal') playSound('normal');
                else if (ball.type === 'wide') { playSound('wide'); if(player.width < MAX_WIDTH) { player.width += 15; if (player.x + player.width > canvas.width) player.x = canvas.width - player.width; } if (!ghostMode) { player.color = '#2ecc71'; setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200); } } 
                else if (ball.type === 'narrow') { playSound('narrow'); if(player.width > MIN_WIDTH) player.width -= 15; if (!ghostMode) { player.color = '#ff4757'; setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200); } }
                else if (ball.type === 'life') { playSound('life'); lives++; livesVal.textContent = lives; if (!ghostMode) { player.color = '#e056fd'; setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200); } }
                else if (ball.type === 'slow') { playSound('slow'); speedReduction += 0.8; if (!ghostMode) { player.color = '#00d2d3'; setTimeout(() => { if(!ghostMode) player.color = '#007bff'; }, 200); } }
                else if (ball.type === 'ghost') { playSound('ghost'); activateGhostMode(); }
                balls.splice(index, 1);
            }
            else if (ball.y - ball.radius > canvas.height) {
                balls.splice(index, 1);
                if (ball.type === 'normal') {
                    if (!ghostMode) { lives--; livesVal.textContent = lives; if (lives <= 0) endGame(); }
                }
            }
        });
        animationId = requestAnimationFrame(animate);
    }

    function startGame() {
        if(audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
        isPlaying = true; isPaused = false; pauseBtn.disabled = false;
        score = 0; lives = 3; balls = []; player.width = 70; player.color = '#007bff';
        speedReduction = 0; ghostMode = false; milestone1200Triggered = false; isRiskingIt = false; securedAmount = 0; finalWonAmount = 0;
        decisionModal.style.display = 'none'; claimModal.style.display = 'none';
        if (ghostTimer) clearTimeout(ghostTimer);
        scoreVal.textContent = 0; livesVal.textContent = 3;
        startBtn.style.display = 'none'; restartBtn.style.display = 'none';
        iconPause.style.display = 'block'; iconPlay.style.display = 'none'; pauseText.textContent = "Pause";
        animate();
    }

    function endGame() {
        if (securedAmount === 1000) { finalWonAmount = 1000; showWinnerScreen(); return; }
        isPlaying = false; isPaused = false; pauseBtn.disabled = true; cancelAnimationFrame(animationId);
        ctx.fillStyle = 'rgba(0,0,0,0.9)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        let msg = "GAME OVER"; let subMsg = "Win: ?0"; let color = "#ff4757";
        if (isRiskingIt) { msg = "RISK FAILED"; subMsg = "You lost the ?500"; }
        else if (securedAmount === 1000) { msg = "?? JACKPOT! ??"; subMsg = "You won ?1,000"; color = "#f1c40f"; } 
        
        ctx.fillStyle = color; ctx.font = 'bold 32px Arial'; ctx.textAlign = 'center'; ctx.fillText(msg, canvas.width / 2, canvas.height / 2 - 20);
        ctx.fillStyle = '#fff'; ctx.font = '20px Arial'; ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
        ctx.font = '16px Arial'; ctx.fillStyle = '#ccc'; ctx.fillText(subMsg, canvas.width / 2, canvas.height / 2 + 50);
        restartBtn.style.display = 'inline-block';
    }

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
    ctx.fillStyle = player.color; ctx.fillRect(player.x, player.y, player.width, player.height);
</script>
</body>
</html>